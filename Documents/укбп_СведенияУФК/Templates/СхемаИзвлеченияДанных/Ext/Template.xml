<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>БанковскийСчетОрганизации</dataPath>
			<field>БанковскийСчетОрганизации</field>
			<inputParameters>
				<dcscor:item>
					<dcscor:parameter>ФормаВыбора</dcscor:parameter>
					<dcscor:value xsi:type="xs:string">ФормаВыбораУправляемая</dcscor:value>
				</dcscor:item>
			</inputParameters>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаказПокупателя</dataPath>
			<field>ЗаказПокупателя</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Заказ покупателя</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЗаказУКБП</dataPath>
			<field>ЗаказУКБП</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Заказ УКБП</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СтатьяСведений</dataPath>
			<field>СтатьяСведений</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Статья сведений</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>УкрупненныйКод</dataPath>
			<field>УкрупненныйКод</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Укрупненный код</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЛимитРасходаПоСведениям</dataPath>
			<field>ЛимитРасходаПоСведениям</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Лимит расхода по сведениям</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДетализированныйКод</dataPath>
			<field>ДетализированныйКод</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Детализированный код</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СуммаСведения</dataPath>
			<field>СуммаСведения</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Сумма сведения</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	укбп_ЗаказЗаявка.Ссылка КАК Ссылка,
	укбп_БанковскиеСчетаДоговоров.БанковскийСчетОрганизации КАК БанковскийСчетОрганизации
ПОМЕСТИТЬ ТаблицаДокументов
ИЗ
	РегистрСведений.укбп_БанковскиеСчетаДоговоров КАК укбп_БанковскиеСчетаДоговоров
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.укбп_ЗаказЗаявка КАК укбп_ЗаказЗаявка
		ПО укбп_БанковскиеСчетаДоговоров.Контрагент = укбп_ЗаказЗаявка.Контрагент
			И укбп_БанковскиеСчетаДоговоров.ДоговорКонтрагента = укбп_ЗаказЗаявка.ДоговорКонтрагента
ГДЕ
	укбп_БанковскиеСчетаДоговоров.БанковскийСчетОрганизации.ТипБанковскогоСчета = ЗНАЧЕНИЕ(Перечисление.укбп_ТипыБанковскихСчетов.КазначейскоеСопровождение)
{ГДЕ
	укбп_БанковскиеСчетаДоговоров.БанковскийСчетОрганизации.*}
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДокументов.Ссылка,
	ТаблицаДокументов.БанковскийСчетОрганизации,
	ЗаказПокупателя.Ссылка КАК ЗаказПокупателя
ПОМЕСТИТЬ ТаблицаДокументовСЗаказамиПокупателей
ИЗ
	ТаблицаДокументов КАК ТаблицаДокументов
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПокупателя КАК ЗаказПокупателя
		ПО ТаблицаДокументов.Ссылка = ЗаказПокупателя.СпецификацияДоговора
ГДЕ
	ЗаказПокупателя.Проведен
{ГДЕ
	ТаблицаДокументов.Ссылка.* КАК ЗаказУКБП,
	ЗаказПокупателя.Ссылка.* КАК ЗаказПокупателя}
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ДенежныеСредстваОстаткиИОбороты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	ДенежныеСредстваОстаткиИОбороты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
	ДенежныеСредстваОстаткиИОбороты.СуммаПриход КАК СуммаПриход
ПОМЕСТИТЬ ТаблицаСДенежнымиСредствами
ИЗ
	РегистрНакопления.ДенежныеСредства.ОстаткиИОбороты(
			{(&amp;НачалоПериода)},
			{(&amp;КонецПериода)},
			,
			,
			БанковскийСчетКасса В
				(ВЫБРАТЬ
					ТаблицаДокументовСЗаказамиПокупателей.БанковскийСчетОрганизации
				ИЗ
					ТаблицаДокументовСЗаказамиПокупателей КАК ТаблицаДокументовСЗаказамиПокупателей)) КАК ДенежныеСредстваОстаткиИОбороты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	укбп_ЗаказЗаявкаИзделия.Ссылка.ВидОперации КАК ВидОперации,
	укбп_ЗаказЗаявкаИзделия.Ссылка.ВидДоговора КАК ВидДоговора,
	укбп_КалькуляцияНаИзделиеКалькуляцияЗатрат.СтатьяКалькуляции КАК СтатьяКалькуляции,
	укбп_ЗаказЗаявкаИзделия.Количество * укбп_КалькуляцияНаИзделиеКалькуляцияЗатрат.Сумма КАК СуммаОриентировочная,
	0 КАК СуммаФиксированная,
	укбп_ЗаказЗаявкаИзделия.Ссылка.укбп_ВидРаздельногоУчета КАК укбп_ВидРаздельногоУчета
ПОМЕСТИТЬ Объединение
ИЗ
	Документ.укбп_ЗаказЗаявка.Изделия КАК укбп_ЗаказЗаявкаИзделия
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.укбп_КалькуляцияНаИзделие.КалькуляцияЗатрат КАК укбп_КалькуляцияНаИзделиеКалькуляцияЗатрат
		ПО укбп_ЗаказЗаявкаИзделия.КалькуляцияНаИзделие = укбп_КалькуляцияНаИзделиеКалькуляцияЗатрат.Ссылка
ГДЕ
	укбп_КалькуляцияНаИзделиеКалькуляцияЗатрат.Ссылка.ТипЦен = &amp;ТипЦенОриент
	И укбп_ЗаказЗаявкаИзделия.Ссылка В
			(ВЫБРАТЬ
				ТаблицаДокументовСЗаказамиПокупателей.Ссылка
			ИЗ
				ТаблицаДокументовСЗаказамиПокупателей КАК ТаблицаДокументовСЗаказамиПокупателей)

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	укбп_ЗаказЗаявкаИзделия.Ссылка.ВидОперации,
	укбп_ЗаказЗаявкаИзделия.Ссылка.ВидДоговора,
	укбп_КалькуляцияНаИзделиеКалькуляцияЗатрат.СтатьяКалькуляции,
	0,
	укбп_ЗаказЗаявкаИзделия.Количество * укбп_КалькуляцияНаИзделиеКалькуляцияЗатрат.Сумма,
	укбп_ЗаказЗаявкаИзделия.Ссылка.укбп_ВидРаздельногоУчета
ИЗ
	Документ.укбп_ЗаказЗаявка.Изделия КАК укбп_ЗаказЗаявкаИзделия
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.укбп_КалькуляцияНаИзделие.КалькуляцияЗатрат КАК укбп_КалькуляцияНаИзделиеКалькуляцияЗатрат
		ПО укбп_ЗаказЗаявкаИзделия.КалькуляцияНаИзделие = укбп_КалькуляцияНаИзделиеКалькуляцияЗатрат.Ссылка
ГДЕ
	укбп_КалькуляцияНаИзделиеКалькуляцияЗатрат.Ссылка.ТипЦен = &amp;ТипЦенФиксир
	И укбп_ЗаказЗаявкаИзделия.Ссылка В
			(ВЫБРАТЬ
				ТаблицаДокументовСЗаказамиПокупателей.Ссылка
			ИЗ
				ТаблицаДокументовСЗаказамиПокупателей КАК ТаблицаДокументовСЗаказамиПокупателей)

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	укбп_ЗаказЗаявкаИзделия.Ссылка.ВидОперации,
	укбп_ЗаказЗаявкаИзделия.Ссылка.ВидДоговора,
	"Прибыль",
	0,
	укбп_ЗаказЗаявкаИзделия.КалькуляцияНаИзделие.Прибыль * укбп_ЗаказЗаявкаИзделия.Количество,
	укбп_ЗаказЗаявкаИзделия.Ссылка.укбп_ВидРаздельногоУчета
ИЗ
	Документ.укбп_ЗаказЗаявка.Изделия КАК укбп_ЗаказЗаявкаИзделия
ГДЕ
	укбп_ЗаказЗаявкаИзделия.Ссылка В
			(ВЫБРАТЬ
				ТаблицаДокументовСЗаказамиПокупателей.Ссылка
			ИЗ
				ТаблицаДокументовСЗаказамиПокупателей КАК ТаблицаДокументовСЗаказамиПокупателей)

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	укбп_ЗаказЗаявкаИзделия.Ссылка.ВидОперации,
	укбп_ЗаказЗаявкаИзделия.Ссылка.ВидДоговора,
	"НДС",
	0,
	ВЫБОР
		КОГДА укбп_ЗаказЗаявкаИзделия.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18)
				ИЛИ укбп_ЗаказЗаявкаИзделия.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18_118)
			ТОГДА 0.18
		КОГДА укбп_ЗаказЗаявкаИзделия.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20)
				ИЛИ укбп_ЗаказЗаявкаИзделия.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20_120)
			ТОГДА 0.2
		КОГДА укбп_ЗаказЗаявкаИзделия.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10)
				ИЛИ укбп_ЗаказЗаявкаИзделия.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10_110)
			ТОГДА 0.1
		КОГДА укбп_ЗаказЗаявкаИзделия.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)
				ИЛИ укбп_ЗаказЗаявкаИзделия.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС0)
			ТОГДА 0
	КОНЕЦ * укбп_ЗаказЗаявкаИзделия.КалькуляцияНаИзделие.Цена * укбп_ЗаказЗаявкаИзделия.Количество,
	укбп_ЗаказЗаявкаИзделия.Ссылка.укбп_ВидРаздельногоУчета
ИЗ
	Документ.укбп_ЗаказЗаявка.Изделия КАК укбп_ЗаказЗаявкаИзделия
ГДЕ
	укбп_ЗаказЗаявкаИзделия.Ссылка В
			(ВЫБРАТЬ
				ТаблицаДокументовСЗаказамиПокупателей.Ссылка
			ИЗ
				ТаблицаДокументовСЗаказамиПокупателей КАК ТаблицаДокументовСЗаказамиПокупателей)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВЫБОР
		КОГДА Объединение.ВидОперации = ЗНАЧЕНИЕ(Перечисление.укбп_ВидОперацииЗаказЗаявка.ПоставкаУслуги)
			ТОГДА ВЫБОР
					КОГДА Объединение.ВидДоговора.Госконтракт
						ТОГДА ЗНАЧЕНИЕ(Справочник.укбп_ВидыРаздельногоУчета.Гоз)
					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.укбп_ВидыРаздельногоУчета.Минпромторг)
				КОНЕЦ
		ИНАЧЕ Объединение.укбп_ВидРаздельногоУчета
	КОНЕЦ КАК ВидРаздельногоУчета,
	Объединение.ВидОперации КАК ВидОперации,
	Объединение.СтатьяКалькуляции КАК СтатьяКалькуляции,
	СУММА(Объединение.СуммаФиксированная + Объединение.СуммаОриентировочная) КАК ВсегоПоКалькуляциям,
	СУММА(Объединение.СуммаФиксированная) КАК СуммаФиксированная,
	СУММА(Объединение.СуммаОриентировочная) КАК СуммаОриентировочная
ПОМЕСТИТЬ ОбъединениеСгруп
ИЗ
	Объединение КАК Объединение
ГДЕ
	Объединение.ВидОперации &lt;&gt; ЗНАЧЕНИЕ(Перечисление.укбп_ВидОперацииЗаказЗаявка.ПустаяСсылка)

СГРУППИРОВАТЬ ПО
	Объединение.СтатьяКалькуляции,
	Объединение.ВидОперации,
	ВЫБОР
		КОГДА Объединение.ВидОперации = ЗНАЧЕНИЕ(Перечисление.укбп_ВидОперацииЗаказЗаявка.ПоставкаУслуги)
			ТОГДА ВЫБОР
					КОГДА Объединение.ВидДоговора.Госконтракт
						ТОГДА ЗНАЧЕНИЕ(Справочник.укбп_ВидыРаздельногоУчета.Гоз)
					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.укбп_ВидыРаздельногоУчета.Минпромторг)
				КОНЕЦ
		ИНАЧЕ Объединение.укбп_ВидРаздельногоУчета
	КОНЕЦ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДССтатьиКалькуляцииЗатрат.Ссылка.УкрупненныйКодСведений КАК УкрупненныйКод,
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДССтатьиКалькуляцииЗатрат.Ссылка.Код КАК ДетализированныйКод,
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДССтатьиКалькуляцииЗатрат.Ссылка КАК ДетализированнаяСтатьяУФК,
	ОбъединениеСгруп.СтатьяКалькуляции КАК СтатьяКалькуляции,
	ОбъединениеСгруп.ВидРаздельногоУчета КАК ВидРаздельногоУчета,
	ОбъединениеСгруп.ВидОперации КАК ВидОперации,
	ОбъединениеСгруп.ВсегоПоКалькуляциям КАК ВсегоПоКалькуляциям,
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДССтатьиКалькуляцииЗатрат.Ссылка.НДС КАК СтавкаНДС
ПОМЕСТИТЬ СУкрупненнымиСтатьями
ИЗ
	ОбъединениеСгруп КАК ОбъединениеСгруп
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.СтатьиКалькуляцииЗатрат КАК укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДССтатьиКалькуляцииЗатрат
		ПО ОбъединениеСгруп.СтатьяКалькуляции = укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДССтатьиКалькуляцииЗатрат.СтатьяКалькуляции

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.УкрупненныйКодСведений,
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.Код,
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.Ссылка,
	ОбъединениеСгруп.СтатьяКалькуляции,
	ОбъединениеСгруп.ВидРаздельногоУчета,
	ОбъединениеСгруп.ВидОперации,
	ОбъединениеСгруп.ВсегоПоКалькуляциям,
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.НДС
ИЗ
	Справочник.укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС КАК укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОбъединениеСгруп КАК ОбъединениеСгруп
		ПО (ИСТИНА)
ГДЕ
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.Ссылка = &amp;СтатьяПрибыль
	И ОбъединениеСгруп.СтатьяКалькуляции = "Прибыль"

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.УкрупненныйКодСведений,
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.Код,
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.Ссылка,
	ОбъединениеСгруп.СтатьяКалькуляции,
	ОбъединениеСгруп.ВидРаздельногоУчета,
	ОбъединениеСгруп.ВидОперации,
	ОбъединениеСгруп.ВсегоПоКалькуляциям,
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.НДС
ИЗ
	Справочник.укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС КАК укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОбъединениеСгруп КАК ОбъединениеСгруп
		ПО (ИСТИНА)
ГДЕ
	укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.Ссылка = &amp;СтатьяНДС
	И ОбъединениеСгруп.СтатьяКалькуляции = "НДС"
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	МАКСИМУМ(ЕСТЬNULL(укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.ПонижающийКоэффициент, 1)) КАК ПонижающийКоэффициент,
	ОбъединениеСгруп.СтатьяКалькуляции КАК СтатьяКалькуляции,
	ОбъединениеСгруп.ВидОперации КАК ВидОперации
ПОМЕСТИТЬ ТаблицаСКоэффициентами
ИЗ
	ОбъединениеСгруп КАК ОбъединениеСгруп
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляции.СрезПоследних(, ) КАК укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних
		ПО ОбъединениеСгруп.ВидОперации = укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.ВидОперации
			И ОбъединениеСгруп.СтатьяКалькуляции = укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.СтатьяКалькуляции

СГРУППИРОВАТЬ ПО
	ОбъединениеСгруп.СтатьяКалькуляции,
	ОбъединениеСгруп.ВидОперации
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОбъединениеСгруп.СтатьяКалькуляции КАК СтатьяКалькуляции,
	ОбъединениеСгруп.СуммаФиксированная + ОбъединениеСгруп.СуммаОриентировочная * ЕСТЬNULL(ТаблицаСКоэффициентами.ПонижающийКоэффициент, 1) КАК Лимит
ПОМЕСТИТЬ КалькуляцииСКоэффициентами
ИЗ
	ОбъединениеСгруп КАК ОбъединениеСгруп
		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаСКоэффициентами КАК ТаблицаСКоэффициентами
		ПО ОбъединениеСгруп.ВидОперации = ТаблицаСКоэффициентами.ВидОперации
			И ОбъединениеСгруп.СтатьяКалькуляции = ТаблицаСКоэффициентами.СтатьяКалькуляции
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУкрупненнымиСтатьями.УкрупненныйКод КАК УкрупненныйКод,
	СУкрупненнымиСтатьями.ДетализированныйКод КАК ДетализированныйКод,
	СУкрупненнымиСтатьями.ДетализированнаяСтатьяУФК КАК ДетализированнаяСтатьяУФК,
	СУкрупненнымиСтатьями.СтатьяКалькуляции КАК СтатьяКалькуляции,
	СУкрупненнымиСтатьями.ВсегоПоКалькуляциям * ЕСТЬNULL(укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.УдельныйВес, 1) КАК ИтогоПоКалькуляции,
	ВЫБОР
		КОГДА СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18)
				ИЛИ СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18_118)
			ТОГДА 0.18
		КОГДА СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20)
				ИЛИ СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20_120)
			ТОГДА 0.2
		КОГДА СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10)
				ИЛИ СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10_110)
			ТОГДА 0.1
		КОГДА СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)
				ИЛИ СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС0)
			ТОГДА 0
	КОНЕЦ * СУкрупненнымиСтатьями.ВсегоПоКалькуляциям * ЕСТЬNULL(укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.УдельныйВес, 1) КАК СуммаНДС,
	СУкрупненнымиСтатьями.ВсегоПоКалькуляциям * ЕСТЬNULL(укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.УдельныйВес, 1) + ВЫБОР
		КОГДА СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18)
				ИЛИ СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС18_118)
			ТОГДА 0.18
		КОГДА СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20)
				ИЛИ СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС20_120)
			ТОГДА 0.2
		КОГДА СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10)
				ИЛИ СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС10_110)
			ТОГДА 0.1
		КОГДА СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)
				ИЛИ СУкрупненнымиСтатьями.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС0)
			ТОГДА 0
	КОНЕЦ * СУкрупненнымиСтатьями.ВсегоПоКалькуляциям * ЕСТЬNULL(укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.УдельныйВес, 1) КАК ПланРасходаВсего,
	ЕСТЬNULL(укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.УдельныйВес, 1) КАК УдельныйВес
ПОМЕСТИТЬ ТаблицаСУдельнымВесом
ИЗ
	СУкрупненнымиСтатьями КАК СУкрупненнымиСтатьями
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляции.СрезПоследних КАК укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних
		ПО СУкрупненнымиСтатьями.СтатьяКалькуляции = укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.СтатьяКалькуляции
			И СУкрупненнымиСтатьями.ДетализированнаяСтатьяУФК = укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.СтатьяУФК
			И СУкрупненнымиСтатьями.ВидРаздельногоУчета = укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.ВидРаздельногоУчета
			И СУкрупненнымиСтатьями.ВидОперации = укбп_УдельныйВесДетализированногоКодаУФКВСтатьеКалькуляцииСрезПоследних.ВидОперации
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаСУдельнымВесом.УкрупненныйКод КАК УкрупненныйКод,
	ТаблицаСУдельнымВесом.ДетализированныйКод КАК ДетализированныйКод,
	ТаблицаСУдельнымВесом.ДетализированнаяСтатьяУФК КАК ДетализированнаяСтатьяУФК,
	ТаблицаСУдельнымВесом.ИтогоПоКалькуляции КАК ИтогоПоКалькуляции,
	ТаблицаСУдельнымВесом.СуммаНДС КАК СуммаНДС,
	ТаблицаСУдельнымВесом.ПланРасходаВсего КАК ПланРасходаВсего,
	ТаблицаСУдельнымВесом.УдельныйВес * ЕСТЬNULL(КалькуляцииСКоэффициентами.Лимит, 0) + ТаблицаСУдельнымВесом.СуммаНДС КАК ЛимитРасходованияСведения
ПОМЕСТИТЬ ТаблицаДетальныеЗаписиПоСтатьямКалькуляции
ИЗ
	ТаблицаСУдельнымВесом КАК ТаблицаСУдельнымВесом
		ЛЕВОЕ СОЕДИНЕНИЕ КалькуляцииСКоэффициентами КАК КалькуляцииСКоэффициентами
		ПО ТаблицаСУдельнымВесом.СтатьяКалькуляции = КалькуляцииСКоэффициентами.СтатьяКалькуляции
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТаблицаДетальныеЗаписиПоСтатьямКалькуляции.УкрупненныйКод КАК УкрупненныйКод,
	ТаблицаДетальныеЗаписиПоСтатьямКалькуляции.ДетализированныйКод КАК ДетализированныйКод,
	ТаблицаДетальныеЗаписиПоСтатьямКалькуляции.ДетализированнаяСтатьяУФК КАК ДетализированнаяСтатьяУФК,
	СУММА(ТаблицаДетальныеЗаписиПоСтатьямКалькуляции.СуммаНДС) КАК СуммаНДС,
	СУММА(ТаблицаДетальныеЗаписиПоСтатьямКалькуляции.ПланРасходаВсего) КАК ПланРасходаВсего,
	СУММА(ТаблицаДетальныеЗаписиПоСтатьямКалькуляции.ЛимитРасходованияСведения) КАК ЛимитРасходованияСведения
ПОМЕСТИТЬ ТолькоСтатьиУФК
ИЗ
	ТаблицаДетальныеЗаписиПоСтатьямКалькуляции КАК ТаблицаДетальныеЗаписиПоСтатьямКалькуляции

СГРУППИРОВАТЬ ПО
	ТаблицаДетальныеЗаписиПоСтатьямКалькуляции.ДетализированныйКод,
	ТаблицаДетальныеЗаписиПоСтатьямКалькуляции.УкрупненныйКод,
	ТаблицаДетальныеЗаписиПоСтатьямКалькуляции.ДетализированнаяСтатьяУФК
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СуммаНДСПоСтатьеНДС.ДетализированнаяСтатьяУФК КАК ДетализированнаяСтатьяУФК,
	СУММА(СуммаНДСПоСтатьеНДС.СуммаНДС) КАК СуммаНДС
ПОМЕСТИТЬ СтатьяТолькоНДС
ИЗ
	(ВЫБРАТЬ
		ВЫРАЗИТЬ(&amp;СтатьяНДС КАК Справочник.укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС) КАК ДетализированнаяСтатьяУФК,
		СУММА(ТолькоСтатьиУФК.СуммаНДС) КАК СуммаНДС
	ИЗ
		ТолькоСтатьиУФК КАК ТолькоСтатьиУФК) КАК СуммаНДСПоСтатьеНДС

СГРУППИРОВАТЬ ПО
	СуммаНДСПоСтатьеНДС.ДетализированнаяСтатьяУФК
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(ТолькоСтатьиУФК.ПланРасходаВсего - ТолькоСтатьиУФК.СуммаНДС) КАК ПланРасходаВсего
ПОМЕСТИТЬ ИтогиПоСтатьямУФК
ИЗ
	ТолькоСтатьиУФК КАК ТолькоСтатьиУФК
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТолькоСтатьиУФК.УкрупненныйКод КАК УкрупненныйКод,
	ТолькоСтатьиУФК.ДетализированныйКод КАК ДетализированныйКод,
	ТолькоСтатьиУФК.ДетализированнаяСтатьяУФК КАК ДетализированнаяСтатьяУФК,
	ТолькоСтатьиУФК.ПланРасходаВсего - ЕСТЬNULL(СтатьяТолькоНДС.СуммаНДС, 0) КАК ПланРасходаВсего,
	(ТолькоСтатьиУФК.ПланРасходаВсего - ЕСТЬNULL(СтатьяТолькоНДС.СуммаНДС, 0)) / ИтогиПоСтатьямУФК.ПланРасходаВсего КАК ДоляДляРасходованияВСведениях,
	ТолькоСтатьиУФК.ЛимитРасходованияСведения - ЕСТЬNULL(СтатьяТолькоНДС.СуммаНДС, 0) КАК ЛимитРасходованияСведения,
	(ТолькоСтатьиУФК.ЛимитРасходованияСведения - ЕСТЬNULL(СтатьяТолькоНДС.СуммаНДС, 0)) / ИтогиПоСтатьямУФК.ПланРасходаВсего КАК ДоляДляЛимита,
	ТаблицаСДенежнымиСредствами.СуммаКонечныйОстаток КАК ИтогоКИспользованиюОстатокДС
ПОМЕСТИТЬ ИтоговаяТаблица
ИЗ
	ТолькоСтатьиУФК КАК ТолькоСтатьиУФК
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИтогиПоСтатьямУФК КАК ИтогиПоСтатьямУФК
		ПО (ИСТИНА)
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТаблицаСДенежнымиСредствами КАК ТаблицаСДенежнымиСредствами
		ПО (ИСТИНА)
		ЛЕВОЕ СОЕДИНЕНИЕ СтатьяТолькоНДС КАК СтатьяТолькоНДС
		ПО ТолькоСтатьиУФК.ДетализированнаяСтатьяУФК = СтатьяТолькоНДС.ДетализированнаяСтатьяУФК
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ИтоговаяТаблица.УкрупненныйКод КАК УкрупненныйКод,
	ИтоговаяТаблица.ДетализированныйКод КАК ДетализированныйКод,
	ИтоговаяТаблица.ДетализированнаяСтатьяУФК КАК СтатьяСведений,
	ВЫРАЗИТЬ(ИтоговаяТаблица.ИтогоКИспользованиюОстатокДС * ИтоговаяТаблица.ДоляДляРасходованияВСведениях КАК ЧИСЛО(15, 2)) КАК СуммаСведения,
	ВЫРАЗИТЬ(ИтоговаяТаблица.ИтогоКИспользованиюОстатокДС * ИтоговаяТаблица.ДоляДляЛимита КАК ЧИСЛО(15, 2)) КАК ЛимитРасходаПоСведениям
{ВЫБРАТЬ
	УкрупненныйКод,
	ДетализированныйКод,
	СтатьяСведений.*,
	СуммаСведения,
	ЛимитРасходаПоСведениям}
ИЗ
	ИтоговаяТаблица КАК ИтоговаяТаблица</query>
		<autoFillFields>false</autoFillFields>
	</dataSet>
	<parameter>
		<name>КонецПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Конец периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>НачалоПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Начало периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>СтатьяНДС</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Статья НДС</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС</v8:Type>
		</valueType>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.ПустаяСсылка</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>СтатьяПрибыль</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Статья прибыль</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС</v8:Type>
		</valueType>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.ПустаяСсылка</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>ТипЦенОриент</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Тип цен ориент</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.ТипыЦенНоменклатуры</v8:Type>
		</valueType>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ТипыЦенНоменклатуры.ПустаяСсылка</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>ТипЦенФиксир</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Тип цен фиксир</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.ТипыЦенНоменклатуры</v8:Type>
		</valueType>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ТипыЦенНоменклатуры.ПустаяСсылка</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДетализированныйКод</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ЛимитРасходаПоСведениям</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СтатьяСведений</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаСведения</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>УкрупненныйКод</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:filter>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">БанковскийСчетОрганизации</dcsset:left>
					<dcsset:comparisonType>Equal</dcsset:comparisonType>
					<dcsset:right xsi:type="dcscor:DesignTimeValue">Справочник.БанковскиеСчета.ПустаяСсылка</dcsset:right>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">ЗаказУКБП</dcsset:left>
					<dcsset:comparisonType>Equal</dcsset:comparisonType>
					<dcsset:right xsi:type="dcscor:DesignTimeValue">Документ.укбп_ЗаказЗаявка.ПустаяСсылка</dcsset:right>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">ЗаказПокупателя</dcsset:left>
					<dcsset:comparisonType>Equal</dcsset:comparisonType>
					<dcsset:right xsi:type="dcscor:DesignTimeValue">Документ.ЗаказПокупателя.ПустаяСсылка</dcsset:right>
				</dcsset:item>
			</dcsset:filter>
			<dcsset:dataParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>КонецПериода</dcscor:parameter>
					<dcscor:value xsi:type="v8:StandardBeginningDate">
						<v8:variant xsi:type="v8:StandardBeginningDateVariant">Custom</v8:variant>
						<v8:date>2021-12-31T00:00:00</v8:date>
					</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>НачалоПериода</dcscor:parameter>
					<dcscor:value xsi:type="v8:StandardBeginningDate">
						<v8:variant xsi:type="v8:StandardBeginningDateVariant">Custom</v8:variant>
						<v8:date>2021-01-01T00:00:00</v8:date>
					</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>СтатьяНДС</dcscor:parameter>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.ПустаяСсылка</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>СтатьяПрибыль</dcscor:parameter>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.укбп_СтатьиУльяновскогоКазначействаПоРасходованиюДС.ПустаяСсылка</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>ТипЦенОриент</dcscor:parameter>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ТипыЦенНоменклатуры.ПустаяСсылка</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>ТипЦенФиксир</dcscor:parameter>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ТипыЦенНоменклатуры.ПустаяСсылка</dcscor:value>
				</dcscor:item>
			</dcsset:dataParameters>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>